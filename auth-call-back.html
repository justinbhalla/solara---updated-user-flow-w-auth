<!DOCTYPE html>
<html lang="en">
<head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>Authenticatingâ€¦</title></head>
<body>
<script type="module">
  import { StytchHeadlessClient } from "https://esm.sh/@stytch/vanilla-js/headless";

  const STYTCH_PUBLIC_TOKEN = "public-token-test-41b83ad2-8bb8-4787-8f9d-8005d9545bc8"; // replace
  const stytch = new StytchHeadlessClient(STYTCH_PUBLIC_TOKEN);

  const params = new URLSearchParams(location.search);
  const next = params.get("next") || "/onboard";
  const token = params.get("token");
  const type = params.get("stytch_token_type") || "oauth";

  try {
    if (!token) throw new Error("No token");
    if (type === "magic_links" || type === "magic_link") {
      await stytch.magicLinks.authenticate(token, { session_duration_minutes: 60 });
    } else {
      await stytch.oauth.authenticate(token, { session_duration_minutes: 60 });
    }
    location.replace(next);
  } catch (e) {
    console.error(e);
    location.replace("/start?auth=error");
  }
</script>
</body>
</html>
